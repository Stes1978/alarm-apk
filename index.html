<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- УНИВЕРСАЛЬНАЯ КОДИРОВКА -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Таймер</title>
    <style>
        body {
            margin: 0;
            padding: 10px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            transform: scale(0.5);
            transform-origin: center center;
        }
        
        .container {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            text-align: center;
            width: 200px;
            position: relative;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .input-group {
            margin: 8px 0;
        }
        
        label {
            font-size: 12px;
            color: #555;
        }
        
        input {
            font-size: 12px;
            padding: 6px;
            width: 50px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-left: 5px;
        }
        
        .button-group {
            margin: 10px 0;
        }
        
        button {
            padding: 6px 10px;
            margin: 3px;
            font-size: 10px;
            border: none;
            border-radius: 4px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #45a049;
        }
        
        #display {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            color: #333;
            font-family: 'Courier New', monospace;
        }
        
        .time-up {
            color: #ff4444;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .alarm-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 68, 68, 0.9);
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            text-align: center;
            min-width: 80px;
        }
        
        .alarm-title {
            font-size: 10px;
            color: white;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .alarm-display {
            font-size: 14px;
            font-weight: bold;
            color: white;
            font-family: 'Courier New', monospace;
        }
        
        .alarm-active {
            background: rgba(255, 0, 0, 0.9);
            animation: pulse 0.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .alarm-controls {
            margin-top: 5px;
        }
        
        .alarm-controls button {
            font-size: 8px;
            padding: 3px 6px;
            margin: 2px;
            background: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Таймер</h1>
        <div class="input-group">
            <label for="minutes">Мин:</label>
            <input type="number" id="minutes" value="5" min="1">
        </div>
        <div class="button-group">
            <button onclick="startTimer()">Старт</button>
            <button onclick="pauseTimer()">Пауза</button>
            <button onclick="resetTimer()">Сброс</button>
        </div>
        <div id="display">--:--</div>
    </div>

    <div class="alarm-container" id="alarmContainer" style="display: none;">
        <div class="alarm-title">БУДИЛЬНИК</div>
        <div class="alarm-display" id="alarmDisplay">00:00</div>
        <div class="alarm-controls">
            <button onclick="stopAlarm()">Выкл</button>
        </div>
    </div>

    <audio id="alarm" loop>
        <source src="alarm.mp3" type="audio/mpeg">
        <source src="alarm.wav" type="audio/wav">
        Ваш браузер не поддерживает аудио элементы.
    </audio>

    <script>
        let timer;
        let timeLeft;
        let isRunning = false;
        let alarmPlayed = false;

        const display = document.getElementById('display');
        const alarmSound = document.getElementById('alarm');
        const minutesInput = document.getElementById('minutes');
        const alarmContainer = document.getElementById('alarmContainer');
        const alarmDisplay = document.getElementById('alarmDisplay');

        function startTimer() {
            if (isRunning) return;
            
            const minutes = parseInt(minutesInput.value);
            if (isNaN(minutes) || minutes <= 0) {
                alert('Введите корректное количество минут!');
                return;
            }
            
            alarmPlayed = false;
            alarmSound.pause();
            alarmSound.currentTime = 0;
            display.classList.remove('time-up');
            alarmContainer.style.display = 'none';
            alarmContainer.classList.remove('alarm-active');
            
            timeLeft = minutes * 60;
            isRunning = true;
            updateDisplay();
            
            timer = setInterval(() => {
                timeLeft--;
                updateDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    isRunning = false;
                    timeUp();
                }
            }, 1000);
        }

        function pauseTimer() {
            if (isRunning) {
                clearInterval(timer);
                isRunning = false;
            }
        }

        function resetTimer() {
            clearInterval(timer);
            isRunning = false;
            alarmPlayed = false;
            alarmSound.pause();
            alarmSound.currentTime = 0;
            display.classList.remove('time-up');
            display.textContent = '--:--';
            minutesInput.value = '5';
            alarmContainer.style.display = 'none';
            alarmContainer.classList.remove('alarm-active');
        }

        function updateDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            display.textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function timeUp() {
            display.textContent = '00:00';
            display.classList.add('time-up');
            showAlarm();
            
            if (!alarmPlayed) {
                playAlarm();
                alarmPlayed = true;
            }
            
            if (navigator.vibrate) {
                navigator.vibrate([500, 200, 500, 200, 500]);
            }
        }

        function showAlarm() {
            alarmContainer.style.display = 'block';
            alarmContainer.classList.add('alarm-active');
            alarmDisplay.textContent = '00:00';
        }

        function stopAlarm() {
            alarmSound.pause();
            alarmSound.currentTime = 0;
            alarmContainer.style.display = 'none';
            alarmContainer.classList.remove('alarm-active');
            alarmPlayed = false;
        }

        function playAlarm() {
            alarmSound.currentTime = 0;
            const playPromise = alarmSound.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    console.log('Сигнал запущен автоматически');
                }).catch(error => {
                    console.log('Автоматическое воспроизведение заблокировано:', error);
                    alert('Нажмите кнопку "Выкл" на будильнике для звука');
                });
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            alarmSound.load();
        });
    </script>
</body>
</html>